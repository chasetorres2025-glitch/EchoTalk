{% extends "admin/base.html" %}

{% block title %}用户详情 - EchoTalk 管理后台{% endblock %}

{% block page_title %}用户详情{% endblock %}

{% block content %}
<!-- 用户信息卡片 -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-person"></i> 基本信息
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" width="120">用户ID</td>
                        <td>{{ user.id }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">昵称</td>
                        <td>{{ user.nickname }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">OpenID</td>
                        <td><code>{{ user.open_id }}</code></td>
                    </tr>
                    <tr>
                        <td class="text-muted">方言</td>
                        <td>{{ user.dialect or '未设置' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">手机号</td>
                        <td>{{ user.phone or '未设置' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">注册时间</td>
                        <td>{{ user.create_time.strftime('%Y-%m-%d %H:%M:%S') if user.create_time else '' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">更新时间</td>
                        <td>{{ user.update_time.strftime('%Y-%m-%d %H:%M:%S') if user.update_time else '' }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-bar-chart"></i> 统计信息
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-3">
                        <div class="stat-value">{{ sessions | length }}</div>
                        <div class="stat-label text-muted">会话数</div>
                    </div>
                    <div class="col-6 mb-3">
                        <div class="stat-value">{{ articles | length }}</div>
                        <div class="stat-label text-muted">文章数</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 会话列表 -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-chat-dots"></i> 会话记录
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>会话ID</th>
                        <th>开始时间</th>
                        <th>结束时间</th>
                        <th>消息数</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions %}
                    <tr>
                        <td>{{ session.id }}</td>
                        <td>{{ session.start_time.strftime('%Y-%m-%d %H:%M') if session.start_time else '' }}</td>
                        <td>{{ session.end_time.strftime('%Y-%m-%d %H:%M') if session.end_time else '进行中' }}</td>
                        <td>{{ session.message_count or 0 }}</td>
                        <td>
                            {% if session.status == 0 %}
                            <span class="badge bg-secondary">进行中</span>
                            {% elif session.status == 1 %}
                            <span class="badge bg-info">已生成文章</span>
                            {% elif session.status == 2 %}
                            <span class="badge bg-success">已完成</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('admin.session_detail', session_id=session.id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i> 查看
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">暂无会话记录</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 文章列表 -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-file-text"></i> 文章记录
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>文章ID</th>
                        <th>标题</th>
                        <th>状态</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for article in articles %}
                    <tr>
                        <td>{{ article.id }}</td>
                        <td>{{ article.title }}</td>
                        <td>
                            {% if article.status == 0 %}
                            <span class="badge bg-secondary">草稿</span>
                            {% elif article.status == 1 %}
                            <span class="badge bg-info">已生成</span>
                            {% elif article.status == 2 %}
                            <span class="badge bg-success">已保存</span>
                            {% endif %}
                        </td>
                        <td>{{ article.create_time.strftime('%Y-%m-%d %H:%M') if article.create_time else '' }}</td>
                        <td>
                            <a href="{{ url_for('admin.article_detail', article_id=article.id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i> 查看
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">暂无文章</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> 返回用户列表
    </a>
</div>
{% endblock %}
