{% extends "admin/base.html" %}

{% block title %}文章详情 - EchoTalk 管理后台{% endblock %}

{% block page_title %}文章详情{% endblock %}

{% block content %}
<!-- 文章信息 -->
<div class="row mb-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-file-text"></i> 文章信息</span>
                <div>
                    {% if article.status == 0 %}
                    <span class="badge bg-secondary">草稿</span>
                    {% elif article.status == 1 %}
                    <span class="badge bg-info">已生成</span>
                    {% elif article.status == 2 %}
                    <span class="badge bg-success">已保存</span>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" width="120">文章ID</td>
                        <td>{{ article.id }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">标题</td>
                        <td>{{ article.title }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">作者</td>
                        <td>{{ article.nickname or '未知' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">OpenID</td>
                        <td><code>{{ article.open_id }}</code></td>
                    </tr>
                    <tr>
                        <td class="text-muted">会话ID</td>
                        <td>
                            {% if article.session_id %}
                            <a href="{{ url_for('admin.session_detail', session_id=article.session_id) }}">{{ article.session_id }}</a>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="text-muted">创建时间</td>
                        <td>{{ article.create_time.strftime('%Y-%m-%d %H:%M:%S') if article.create_time else '' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">更新时间</td>
                        <td>{{ article.update_time.strftime('%Y-%m-%d %H:%M:%S') if article.update_time else '' }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-gear"></i> 操作
            </div>
            <div class="card-body">
                <form action="{{ url_for('admin.delete_article', article_id=article.id) }}" method="POST" onsubmit="return confirm('确定要删除此文章吗？此操作不可恢复。');">
                    <button type="submit" class="btn btn-danger w-100">
                        <i class="bi bi-trash"></i> 删除文章
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 文章内容 -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-file-earmark-text"></i> 文章内容
    </div>
    <div class="card-body">
        <div class="article-content" style="line-height: 1.8; font-size: 1rem;">
            {% if article.final_content %}
                {{ article.final_content | replace('\n', '<br>') | safe }}
            {% elif article.draft_content %}
                {{ article.draft_content | replace('\n', '<br>') | safe }}
            {% else %}
                <div class="text-center text-muted py-4">
                    <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                    <p class="mt-3">暂无内容</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('admin.articles') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> 返回文章列表
    </a>
</div>
{% endblock %}
