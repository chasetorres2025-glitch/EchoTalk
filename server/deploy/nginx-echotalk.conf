# EchoTalk Nginx 配置文件
# 根据你的服务器环境选择以下两种方式之一

# ============================================
# 方式一：添加到现有 server 块（推荐）
# ============================================
# 如果服务器上已有其他服务在运行（如 even_sys_app），
# 需要将以下 location 配置添加到 /etc/nginx/nginx.conf 的 server 块中

# 首先，在 http 块中添加 upstream（放在 existing upstream 旁边）
upstream echotalk_backend {
    server 127.0.0.1:5050;
    keepalive 32;
}

# 然后，在现有的 server 块中添加以下 location 配置
# location /echotalk/static/ {
#     alias /app/services/EchoTalk/static/;
#     expires 30d;
#     add_header Cache-Control "public, immutable";
# }
#
# location /echotalk/uploads/ {
#     alias /app/services/EchoTalk/uploads/;
#     expires 7d;
#     add_header Cache-Control "public";
# }
#
# location /echotalk/health {
#     proxy_pass http://echotalk_backend/health;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_connect_timeout 5s;
#     proxy_send_timeout 60s;
#     proxy_read_timeout 60s;
# }
#
# location /echotalk/api/ {
#     proxy_pass http://echotalk_backend/api/;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection $connection_upgrade;
#     proxy_connect_timeout 5s;
#     proxy_send_timeout 60s;
#     proxy_read_timeout 60s;
# }
#
# location /echotalk/admin/ {
#     proxy_pass http://echotalk_backend/admin/;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_connect_timeout 5s;
#     proxy_send_timeout 60s;
#     proxy_read_timeout 60s;
# }
#
# location /echotalk/test_voice {
#     proxy_pass http://echotalk_backend/test_voice;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
# }
#
# location = /echotalk {
#     return 302 /echotalk/admin/;
# }
# location = /echotalk/ {
#     return 302 /echotalk/admin/;
# }

# ============================================
# 方式二：使用独立端口（无需修改主配置）
# ============================================
# 取消注释以下配置，使用 8080 端口访问 EchoTalk
# 访问地址：http://服务器IP:8080/

# server {
#     listen 8080;
#     server_name _;
#     
#     # 增加请求体大小限制（语音文件上传需要）
#     client_max_body_size 50M;
#     client_body_buffer_size 16K;
#     server_tokens off;
#
#     # EchoTalk 专用日志
#     access_log /var/log/nginx/echotalk-access.log main;
#     error_log /var/log/nginx/echotalk-error.log warn;
#
#     # 静态文件服务
#     location /static/ {
#         alias /app/services/EchoTalk/static/;
#         expires 30d;
#         add_header Cache-Control "public, immutable";
#     }
#
#     # 上传文件服务
#     location /uploads/ {
#         alias /app/services/EchoTalk/uploads/;
#         expires 7d;
#         add_header Cache-Control "public";
#     }
#
#     # 所有请求代理到后端
#     location / {
#         proxy_pass http://echotalk_backend;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection $connection_upgrade;
#         proxy_connect_timeout 5s;
#         proxy_send_timeout 60s;
#         proxy_read_timeout 60s;
#     }
# }

# ============================================
# 方式三：使用独立域名（需要 DNS 配置）
# ============================================
# 如果你有独立域名（如 echotalk.your-domain.com），
# 取消注释以下配置

# server {
#     listen 80;
#     server_name echotalk.your-domain.com;
#     
#     client_max_body_size 50M;
#     client_body_buffer_size 16K;
#     server_tokens off;
#
#     access_log /var/log/nginx/echotalk-access.log main;
#     error_log /var/log/nginx/echotalk-error.log warn;
#
#     location /static/ {
#         alias /app/services/EchoTalk/static/;
#         expires 30d;
#         add_header Cache-Control "public, immutable";
#     }
#
#     location /uploads/ {
#         alias /app/services/EchoTalk/uploads/;
#         expires 7d;
#         add_header Cache-Control "public";
#     }
#
#     location / {
#         proxy_pass http://echotalk_backend;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection $connection_upgrade;
#         proxy_connect_timeout 5s;
#         proxy_send_timeout 60s;
#         proxy_read_timeout 60s;
#     }
# }
